[metadata]
creation_date = "2025/10/31"
integration = ["slack"]
maturity = "production"
updated_date = "2025/10/31"

[rule]
author = ["Elastic"]
description = """
Detects when Slack's anomaly detection system identifies suspicious credential testing activity. This typically indicates
brute force attacks, credential stuffing campaigns, or automated tools attempting to validate stolen credentials against
Slack accounts. This is a critical indicator of an active attack attempting to gain unauthorized access.
"""
false_positives = [
    "Legitimate security testing or password strength validation tools if not properly configured",
    "Misconfigured SSO or authentication systems repeatedly testing credentials",
    "Users repeatedly entering incorrect passwords during legitimate login attempts"
]
from = "now-60m"
index = ["filebeat-*", "logs-slack*"]
interval = "5m"
language = "kuery"
license = "Elastic License v2"
name = "Slack Credential Testing Attack Detected"
note = """## Triage and analysis

### Investigating Slack Credential Testing Attack

Credential testing anomalies in Slack indicate that credentials are being systematically tested for validity under
suspicious circumstances. This is often associated with credential stuffing attacks, where attackers use lists of
compromised username/password pairs from data breaches to attempt unauthorized access to accounts.

This detection is particularly concerning because it suggests:
- Active exploitation of stolen credentials from data breaches
- Automated brute force attacks against Slack accounts
- Targeted attacks attempting to gain initial access to the organization
- Potential password spraying attacks using common passwords
- Verification of credentials before conducting further malicious activities

#### Possible investigation steps

- Identify the targeted accounts by reviewing `slack.audit.actor.user.email` or `slack.audit.entity.email` fields.
- Examine the source IP addresses and check if they are from known malicious sources or unusual geographic locations.
- Review the `slack.audit.context.session_id` field to understand if any sessions were successfully established.
- Check authentication logs for patterns:
  - Multiple failed login attempts followed by a successful one (indicates credential found)
  - Rapid succession of login attempts across multiple accounts (credential stuffing)
  - Login attempts with slight variations of usernames or passwords
- Correlate with other security systems to check if similar attacks are occurring against other services.
- Review the timing and velocity of attempts to understand the attack pattern.
- Check if any of the tested accounts have recently appeared in known data breaches (use breach notification services).
- Look for successful authentications immediately following the credential testing events.
- Examine if MFA challenges were triggered or bypassed during these attempts.
- Review recent password reset requests for the affected accounts.

### False positive analysis

- Legitimate users who have forgotten their passwords may trigger this after multiple failed attempts.
- Automated systems or scripts with outdated credentials might cause repeated authentication failures.
- SSO synchronization issues could result in repeated credential validation attempts.
- Password managers with incorrect stored credentials might trigger this detection.
- Development or testing environments using production Slack workspaces might generate testing patterns.

### Response and remediation

- **Immediate Actions:**
  - Block the source IP addresses at the firewall or through Slack's IP allowlisting features.
  - Force password resets for all affected accounts immediately.
  - Enable MFA for all targeted accounts if not already enabled.
  - Temporarily increase authentication logging verbosity for affected accounts.
  - Consider implementing CAPTCHA or rate limiting for authentication attempts.

- **Investigation Actions:**
  - Compile a list of all accounts that were tested during the attack.
  - Check if any accounts were successfully compromised (look for successful logins after multiple failures).
  - Review activity from any successfully compromised accounts for data access or exfiltration.
  - Cross-reference targeted accounts with recent data breach notifications.
  - Analyze attack patterns to identify the tool or method being used.

- **Communication Actions:**
  - Notify affected users about the attempted unauthorized access.
  - Advise users to change passwords on other services if they reuse passwords.
  - Send organization-wide communication about the importance of unique, strong passwords.
  - Remind users to enable MFA on all critical services.

- **Long-term Actions:**
  - Implement or strengthen password policies (complexity, history, expiration).
  - Deploy adaptive authentication that increases security requirements for suspicious login attempts.
  - Consider implementing passwordless authentication methods.
  - Set up monitoring for accounts appearing in breach databases.
  - Implement IP reputation checking for all authentication attempts.
  - Regular security awareness training focusing on password security and phishing prevention.

## Setup

The Slack Fleet integration, Filebeat module, or similarly structured data is required for this rule to function.
Slack's audit log anomaly detection must be enabled to detect and log credential testing patterns. The rule monitors
for the 'unexpected_credential_testing' reason in the `slack.audit.details.reason` field. Ensure comprehensive audit
logging is enabled and that failed authentication attempts are being captured alongside successful ones for proper
correlation during investigation."""
references = [
    "https://docs.slack.dev/reference/audit-logs-api/anomalous-events-reference/",
    "https://owasp.org/www-community/attacks/Credential_stuffing",
    "https://attack.mitre.org/techniques/T1110/"
]
risk_score = 87
rule_id = "b6859171-de29-4fc0-a5cb-8542e87aedd6"
severity = "high"
tags = [
    "Data Source: Slack",
    "Use Case: Threat Detection",
    "Tactic: Credential Access",
    "Resources: Investigation Guide"
]
timestamp_override = "event.ingested"
type = "query"

query = '''
event.dataset:slack.audit and event.action:anomaly and slack.audit.details.reason:unexpected_credential_testing
'''


[[rule.threat]]
framework = "MITRE ATT&CK"
[[rule.threat.technique]]
id = "T1110"
name = "Brute Force"
reference = "https://attack.mitre.org/techniques/T1110/"
[[rule.threat.technique.subtechnique]]
id = "T1110.001"
name = "Password Guessing"
reference = "https://attack.mitre.org/techniques/T1110/001/"

[[rule.threat.technique.subtechnique]]
id = "T1110.002"
name = "Password Cracking"
reference = "https://attack.mitre.org/techniques/T1110/002/"

[[rule.threat.technique.subtechnique]]
id = "T1110.003"
name = "Password Spraying"
reference = "https://attack.mitre.org/techniques/T1110/003/"

[[rule.threat.technique.subtechnique]]
id = "T1110.004"
name = "Credential Stuffing"
reference = "https://attack.mitre.org/techniques/T1110/004/"

[rule.threat.tactic]
id = "TA0006"
name = "Credential Access"
reference = "https://attack.mitre.org/tactics/TA0006/"